####################################
# Created By: Allison Bertie Johnson
# Working Directory: /home/abj15/Research.Project/Run/HapCUT/6.3.2019
# Mannual: https://github.com/vibansal/hapcut/blob/master/README.md
# HapCUT: Example Run
####################################
# Reinstalling HapCUT 

[abj15@login2 6.2.2019]$ cd /home/abj15/Research.Project/Software/HapCUT
[abj15@login2 HapCUT]$ ls
hapcut-master.zip
[abj15@login2 HapCUT]$ unzip hapcut-master.zip
Archive:  hapcut-master.zip
254c473066565e6b9d11b0e725e17ff910dcfbb1
   creating: hapcut-master/
  inflating: hapcut-master/FAQ.md
   creating: hapcut-master/FragmentCut/
   creating: hapcut-master/FragmentCut/DATA/
.
.
.
 extracting: hapcut-master/testdata/NA18508.chr20.test.bam
  inflating: hapcut-master/testdata/README.md
  inflating: hapcut-master/testdata/fosmiddata.chr20.fragments
[abj15@login2 HapCUT]$ ls
hapcut-master  hapcut-master.zip
[abj15@login2 HapCUT]$ cd hapcut-master
[abj15@login2 hapcut-master]$ ls
FAQ.md  FragmentCut  hapcut-src  INSTALL  Makefile  parsebam  README.md  scripts  testdata  UPDATES
[abj15@login2 hapcut-master]$ more README.md
## Note that [HapCUT2](https://github.com/vibansal/hapcut2) is now available. It is faster and more accurate than HapCUT for all types of sequence data.


HAPCUT, version 0.7, Vikas Bansal (vibansal@ucsd.edu), last modified: March 25 2014

## Introduction

HapCUT is a max-cut based algorithm for haplotype assembly that uses the mix of sequenced fragments from the two chromosomes of an individual, this program can be appli
ed to sequence data generated from next-generation sequencing platforms. HapCUT takes as input the aligned SAM/BAM files for an individual diploid genome and the list o
f variants, and outputs the phased haplotype blocks that can be assembled from the sequence reads. HapCUT is described in the following artice:

An efficient and accurate algorithm for the haplotype assembly problem Bioinformatics. 2008 Aug 15;24(16):i153-9.


## Requirements:

To run HapCUT, you need at least the following files:

1. A file with aligned reads for the individual diploid genome. HapCUT currently accepts BAM files that are coordinate sorted, i.e. by chromosomal position.

2. A file with the list of variants and genotypes for the diploid genome. HapCUT currently accepts variants file in VCF format (variants and genotypes for a single indi
vidual). For specification of the VCF format, please see http://www.1000genomes.org/wiki/Analysis/Variant%20Call%20Format/vcf-variant-call-format-version-41. Note that
VCF format is required for phasing indels.

3. The reference sequence file used to align the reads. This file should be in the fasta format and indexed using samtools to generate a .fai file. This file is optiona
l but required for phasing indels.


## Format of input and output files:

1. BAM file with read alignments: This file should be coordinate sorted, e.g. using the "samtools sort" command. In addition, the mate-chromosome and mate-position (col
umns 7 and 8 for an aligned read) should reflect the reference chromosome and position of the mate for paired-end reads.


2. VCF file: This file should contain the variants and genotypes for a single individual that is to be phased. Please make sure that the VCF file conforms to the standa
rd VCF format, since HapCUT does not check this.

3. hapCUT variant file: Each line of this file represents a heterozygous variant (SNP/indel). The file should be sorted with respect to chromosomal position. Format of
each line is: variantid chromosome position allele1 allele2 genotype genotype_quality. An example of a variant in this file is as follows:

SNP chr4 45322434 A C A/C 65  (he chromosomal position is 1-based rather than 0-based)

It is preferrable to use the VCF format for variants.

4. Output file: this file contains the phased haplotype blocks generated by HapCUT. Each block (connected component in the fragment matrix) has the following format:

"BLOCK: offset:" first_variant_block "len:" length_of_block "phased": phased_variants_block SPAN: lengthspanned MECscore score fragments #fragments

Subsequently, each line represents a variant that is phased as part of the block in the following format:

variant_id haplotype_1 haplotype_2 chromosome position refallele variantallele genotype allele_counts:genotype_likelihoods:delta:MEC_variant

        Haplotype_1 and Haplotype_2 correspond to the two phased haplotypes (0 corresponds to the refallele and 1 corresponds to the variantallele)

        allele_counts: two integers that correspond to the number of reads supporting the two haplotypes at this variant
[abj15@login2 hapcut-master]$ more INSTALL
REQUIREMENTS
=============

HapCUT is written in C and requires a gcc like compiler to compile the source code. HapCUT also requires the SAMtools package (http://samtools.sourceforge.net/) to read
 BAM files.


HOW TO COMPILE THE CODE
========================

07/04/2015: The code can now be compiled by running 'make all' in the hapcut-master directory


OLD INSTRUCTIONS TO COMPILE CODE
================================

1. Download the SAMtools package from sourceforge: http://sourceforge.net/projects/samtools/files/samtools/0.1.18/
2. Unzip files in the directory 'samtools' and run 'make' in the 'samtools' directory
3. Download the hapcut-master source code and unzip to create hapcut-master directory
4. Copy the samtools directory to the hapcut-master directory or modify the Makefile to point to the location of the 'samtools' directory
5. run 'make hairs' in the hapcut-master directory and 'make HAPCUT' in the hapcut-master/hapcut-src' directory

[abj15@login2 hapcut-master]$ ls
FAQ.md  FragmentCut  hapcut-src  INSTALL  Makefile  parsebam  README.md  samtools-1.2.tar.bz2  scripts  testdata  UPDATES
[abj15@login2 hapcut-master]$ tar xjvf samtools-1.2.tar.bz2
samtools-1.2/
samtools-1.2/AUTHORS
samtools-1.2/ChangeLog.old
samtools-1.2/INSTALL
.
.
.
samtools-1.2/htslib-1.2.1/vcf_sweep.c
samtools-1.2/htslib-1.2.1/vcfutils.c
samtools-1.2/htslib-1.2.1/configure
[abj15@login2 hapcut-master]$ ls
FAQ.md  FragmentCut  hapcut-src  INSTALL  Makefile  parsebam  README.md  samtools-1.2  samtools-1.2.tar.bz2  scripts  testdata  UPDATES

[abj15@login2 hapcut-master]$ make
make -C parsebam/samtools-0.1.18 all
make[1]: Entering directory `/gpfs/home/abj15/Research.Project/Software/HapCUT/hapcut-master/parsebam/samtools-0.1.18'
make[2]: Entering directory `/gpfs/home/abj15/Research.Project/Software/HapCUT/hapcut-master/parsebam/samtools-0.1.18'
.
.
.
hapcut.c:49: warning: unused variable 'j'
make[1]: Leaving directory `/gpfs/home/abj15/Research.Project/Software/HapCUT/hapcut-master/hapcut-src'
cp hapcut-src/HAPCUT parsebam/extractHAIRS .;
[abj15@login2 hapcut-master]$ ls
extractHAIRS  FAQ.md  FragmentCut  HAPCUT  hapcut-src  INSTALL  Makefile  parsebam  README.md  samtools-1.2  samtools-1.2.tar.bz2  scripts  testdata  UPDATES

#########################################################
#
# Running example file/script 
# 1st step: extracting haplotype information

[abj15@login2 6.3.2019]$ /home/abj15/Research.Project/Software/HapCUT/hapcut-master/./extractHAIRS --VCF /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.VCF --bam /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.bam --maxIS 600 > fragment_matrix_file

 extracting haplotype informative reads from bamfiles /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.bam minQV 13 minMQ 20 maxIS 600

VCF file /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.VCF has 267 variants
vcffile /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.VCF chromosomes 1 hetvariants 188 267
reading sorted bamfile /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.bam
final cleanup of fragment list: 5727 current chrom 20 199999
[abj15@login2 6.3.2019]$ ls
fragment_matrix_file
[abj15@login2 6.3.2019]$ wc -l 
1448 fragment_matrix_file

#
# Running HapCUT 
#

[abj15@login2 6.3.2019]$ /home/abj15/Research.Project/Software/HapCUT/hapcut-master/./HAPCUT --fragments fragment_matrix_file --VCF /home/abj15/Research.Project/Softwar/HapCUT/hapcut-master/testdata/NA18508.chr20.test.VCF --output output_haplotype_file --maxiter maxiter > hapcut.log


fragment file: fragment_matrix_file
variantfile (VCF format):/home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.VCF
haplotypes will be output to file: output_haplotype_file
iterations of maxcut algorithm: 0
QVoffset: 33

calling MAXCUT based haplotype assembly algorithm
read 267 variants from /home/abj15/Research.Project/Software/HapCUT/hapcut-master/testdata/NA18508.chr20.test.VCF file
processed fragment file and variant file: fragments 1448 variants 267
0.414336 MB memory needs to be allocated for graph edges

no of non-trivial connected components 40 max-Degree 92 connected variants 134 coverage-per-variant 23.858209
fragments 1448 snps 267 component(blocks) 40
[abj15@login2 6.3.2019]$ ls
fragment_matrix_file  hapcut.log
[abj15@login2 6.3.2019]$ wc -l *
 1448 fragment_matrix_file
   43 hapcut.log
 1491 total
[abj15@login2 6.3.2019]$ more hapcut.log

no of non-trivial connected components 40 max-Degree 92 connected variants 134 coverage-per-variant 23.858209
comp 0 first 57 last 59 phased 3 fragments 32
comp 1 first 60 last 62 phased 2 fragments 14
comp 2 first 65 last 68 phased 4 fragments 58
comp 3 first 69 last 70 phased 2 fragments 34
comp 4 first 71 last 74 phased 3 fragments 20
comp 5 first 78 last 79 phased 2 fragments 15
comp 6 first 82 last 83 phased 2 fragments 42
comp 7 first 85 last 87 phased 3 fragments 22
comp 8 first 88 last 91 phased 4 fragments 34
comp 9 first 92 last 96 phased 5 fragments 52
comp 10 first 98 last 99 phased 2 fragments 20
comp 11 first 101 last 103 phased 3 fragments 32
comp 12 first 108 last 110 phased 3 fragments 42
comp 13 first 111 last 112 phased 2 fragments 8
comp 14 first 115 last 117 phased 3 fragments 24
comp 15 first 118 last 128 phased 10 fragments 136
comp 16 first 141 last 142 phased 2 fragments 8
comp 17 first 144 last 150 phased 6 fragments 113
comp 18 first 156 last 158 phased 2 fragments 3
comp 19 first 163 last 166 phased 4 fragments 61
comp 20 first 167 last 169 phased 2 fragments 7
############################################################################